(()=>{var e={};e.id=374,e.ids=[374],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},9073:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>x,routeModule:()=>u,serverHooks:()=>g,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>m});var a={};t.r(a),t.d(a,{GET:()=>c,POST:()=>l});var n=t(2706),s=t(8203),i=t(5994),o=t(1568),d=t(5600);async function l(e){try{let{modelName:r,asset:t,direction:a,entryPrice:n,exitPrice:s,leverage:i,pnlPercent:l,pnlUsd:c,holdingHours:u,rarity:p,reasoning:m}=await e.json();if(!r||!t||!a)return o.NextResponse.json({error:"Missing required fields"},{status:400});for(let[e,r]of Object.entries({entryPrice:n,exitPrice:s,leverage:i,holdingHours:u}))if(!Number.isFinite(r)||r<0)return o.NextResponse.json({error:`Invalid ${e}: must be a positive number`},{status:400});if(!Number.isFinite(l)||!Number.isFinite(c))return o.NextResponse.json({error:"Invalid pnlPercent or pnlUsd: must be a number"},{status:400});let g=m?m.trim().substring(0,200).replace(/<[^>]*>/g,""):null,x=await d.z.tradingModel.findUnique({where:{name:r}});if(!x)return o.NextResponse.json({error:"Trading model not found"},{status:404});let P=await d.z.tradeCard.create({data:{modelId:x.id,asset:t,direction:a,entryPrice:n,exitPrice:s,leverage:i,pnlPercent:l,pnlUsd:c,holdingHours:u,rarity:p,reasoning:g},include:{model:!0}}),h=await d.z.tradeCard.aggregate({where:{modelId:x.id},_count:{id:!0},_sum:{pnlPercent:!0}}),v=await d.z.tradeCard.count({where:{modelId:x.id,pnlPercent:{gt:0}}});return await d.z.tradingModel.update({where:{id:x.id},data:{totalTrades:h._count.id,winCount:v,totalPnlPct:h._sum.pnlPercent||0}}),o.NextResponse.json({success:!0,tradeCard:{id:P.id,modelName:P.model.name,modelAvatar:P.model.avatar,asset:P.asset,direction:P.direction,entryPrice:P.entryPrice,exitPrice:P.exitPrice,leverage:P.leverage,pnlPercent:P.pnlPercent,pnlUsd:P.pnlUsd,holdingHours:P.holdingHours,rarity:P.rarity,reasoning:P.reasoning,createdAt:P.createdAt}})}catch(e){return console.error("Error creating trade card:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}async function c(e){try{let{searchParams:r}=new URL(e.url),t=Math.max(1,parseInt(r.get("page")||"1")),a=Math.min(100,Math.max(1,parseInt(r.get("limit")||"20"))),n=r.get("modelId"),s=r.get("asset"),i={...n&&{modelId:n},...s&&{asset:s}},[l,c]=await Promise.all([d.z.tradeCard.findMany({where:i,include:{model:!0},orderBy:{createdAt:"desc"},skip:(t-1)*a,take:a}),d.z.tradeCard.count({where:i})]),u=l.map(e=>({id:e.id,modelName:e.model.name,modelAvatar:e.model.avatar,asset:e.asset,direction:e.direction,entryPrice:e.entryPrice,exitPrice:e.exitPrice,leverage:e.leverage,pnlPercent:e.pnlPercent,pnlUsd:e.pnlUsd,holdingHours:e.holdingHours,rarity:e.rarity,reasoning:e.reasoning,createdAt:e.createdAt}));return o.NextResponse.json({tradeCards:u,pagination:{page:t,limit:a,total:c,totalPages:Math.ceil(c/a)}})}catch(e){return console.error("Error fetching trade cards:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}let u=new n.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/trade-cards/route",pathname:"/api/trade-cards",filename:"route",bundlePath:"app/api/trade-cards/route"},resolvedPagePath:"E:\\kiro projects\\dynamous-kiro-hackathon\\src\\app\\api\\trade-cards\\route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:p,workUnitAsyncStorage:m,serverHooks:g}=u;function x(){return(0,i.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:m})}},6487:()=>{},8335:()=>{},5600:(e,r,t)=>{"use strict";t.d(r,{z:()=>n});let a=require("@prisma/client"),n=globalThis.prisma??new a.PrismaClient}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[638,452],()=>t(9073));module.exports=a})();